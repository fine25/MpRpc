# MpRpc

C++分布式网络通信框架项目基于muduo高性能网络库+Protobuf+Cmake+zookeeper开发。

# 技术栈

技术栈主要包括：集群和分布式概念以及原理、RPC远程过程调用原理以及实现、Protobuf数据序列化和反序列化协议、ZooKeeper分布式一致性协调服务应用以及编程、muduo网络库编程、conf配置文件读取、异步日志、CMake构建项目集成编译环境。

# 工作流程

项目整体模块是rpc服务调用方、rpc服务提供方和zookeeper服务配置中心。

首先rpc服务提供方先与zookeeper建立会话，维护一个rpc方法的map表，把服务方法都注册在zookeeper的node节点上

然后rpc提供方启动网络服务，使用muduo网络库，创建一个IO线程，三个worker线程，muduo绑定回调，onMessage和onConnection回调，调用start、loop方法，rpc服务节点启动。

之后rpc调用方，就可以发起调用了，会调用到RpcChannel的CallMethod方法的上，然后进行参数的打包、数据的序列化，获取service_name和method_name，组成相应的znode的节点路径向zookeeper上查询一下所要调用的服务所在的主机ip和端口号，查到之后开始组装数据，就可以发起rpc调用请求了。

rpc服务提供方收到请求后，通过muduo的OnMessage获取网络字符流的反序列化参数，生成request和response，其中request已经反序列化数据，根据service_name和method_name找到service对象和method对象，绑定发送回调，调用到业务层的service.callMethod，执行获取相应数据做本地业务，写入响应（包括错误码、错误消息、返回值）然后执行回调进行数据的序列化把response转化为字符串，通过网络发送到rpc服务调用方，然后通过rpc服务提供方主动关闭链接。

此上面就是整个框架的主要流程
